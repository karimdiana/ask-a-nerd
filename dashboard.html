<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Dashboard - Nerd</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/dashboard.css">
</head>
<body>
    <!-- Top Navigation Bar -->
    <header class="app-header">
        <div class="header-left">
            <a href="account.html" class="user-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20 21C20 16.5817 16.4183 13 12 13C7.58172 13 4 16.5817 4 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </a>
        </div>
        <div class="header-center">
            <a href="dashboard.html" class="header-logo-link">
                <img src="photos/nerd.png" alt="Nerd" class="header-logo">
            </a>
        </div>
        <div class="header-right">
            <a href="index.html" class="signout-btn">Sign Out</a>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- Greeting Banner -->
            <div class="greeting-banner">
                <h2 class="greeting-text">Welcome back! ðŸ‘‹</h2>
                <p class="greeting-subtitle">Here are nerds in your favorite categories:</p>
            </div>
            
            <!-- Category Filter Tabs -->
            <div class="category-tabs">
                <button class="category-tab active" data-category="all">All</button>
                <button class="category-tab" data-category="business">Business</button>
                <button class="category-tab" data-category="executive">Executive</button>
                <button class="category-tab" data-category="marketing">Marketing</button>
                <button class="category-tab" data-category="academic">Academic</button>
                <button class="category-tab" data-category="entrepreneur">Entrepreneur</button>
                <button class="category-tab" data-category="mentor">Mentoring</button>
                <button class="category-tab" data-category="education">Education</button>
            </div>
            
            <!-- Search and Sort Controls -->
            <div class="controls-row">
                <div class="search-container">
                    <span class="search-icon">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                    <input type="text" placeholder="Search nerds by name or category..." class="search-input">
                </div>
                <div class="sort-favorites">
                    <button class="favorites-toggle">
                        <svg width="20" height="18" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 17.25L8.55 16.0125C4.15 12.1125 1.25 9.5125 1.25 6.375C1.25 3.775 3.275 1.75 5.875 1.75C7.35 1.75 8.7625 2.4375 9.625 3.5C10.4875 2.4375 11.9 1.75 13.375 1.75C15.975 1.75 18 3.775 18 6.375C18 9.5125 15.1 12.1125 10.7 16.0125L9.25 17.25H10Z" fill="none" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                        Favorites
                    </button>
                </div>
            </div>
            
            <!-- Nerds Grid -->
            <div class="nerds-grid">
                <!-- Nerd Card 1 -->
                <div class="nerd-card" data-categories="business,executive">
                    <div class="nerd-card-inner">
                        <div class="nerd-image-section">
                            <img class="nerd-image" alt="Nerd Profile Picture" src="photos/andrew.png">
                        </div>
                        <div class="nerd-info-section">
                            <h2 class="nerd-name">Andrew DeBad</h2>
                            <div class="nerd-tags-container">
                                <span class="category-tag">Business</span>
                                <span class="category-tag">Executive</span>
                            </div>
                        </div>
                        <div class="nerd-actions-section">
                            <button class="btn btn-primary action-button chat-btn">Chat with Me</button>
                            <button class="btn btn-outline-primary action-button about-btn">About Me</button>
                        </div>
                        <div class="favorite-toggle">
                            <i class="bi bi-heart favorite-icon"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Nerd Card 2 -->
                <div class="nerd-card" data-categories="marketing,business,academic">
                    <div class="nerd-card-inner">
                        <div class="nerd-image-section">
                            <img class="nerd-image" alt="Nerd Profile Picture" src="photos/lisa.png">
                        </div>
                        <div class="nerd-info-section">
                            <h2 class="nerd-name">Lisa Menu</h2>
                            <div class="nerd-tags-container">
                                <span class="category-tag">Marketing</span>
                                <span class="category-tag">Academic</span>
                            </div>
                        </div>
                        <div class="nerd-actions-section">
                            <button class="btn btn-primary action-button chat-btn">Chat with Me</button>
                            <button class="btn btn-outline-primary action-button about-btn">About Me</button>
                        </div>
                        <div class="favorite-toggle">
                            <i class="bi bi-heart favorite-icon"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Nerd Card 3 -->
                <div class="nerd-card" data-categories="business,entrepreneur,mentor">
                    <div class="nerd-card-inner">
                        <div class="nerd-image-section">
                            <img class="nerd-image" alt="Nerd Profile Picture" src="photos/karl.png">
                        </div>
                        <div class="nerd-info-section">
                            <h2 class="nerd-name">Karl Fruit</h2>
                            <div class="nerd-tags-container">
                                <span class="category-tag">Entrepreneurship</span>
                            </div>
                        </div>
                        <div class="nerd-actions-section">
                            <button class="btn btn-primary action-button chat-btn">Chat with Me</button>
                            <button class="btn btn-outline-primary action-button about-btn">About Me</button>
                        </div>
                        <div class="favorite-toggle">
                            <i class="bi bi-heart favorite-icon"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Nerd Card 4 -->
                <div class="nerd-card" data-categories="education,academic">
                    <div class="nerd-card-inner">
                        <div class="nerd-image-section">
                            <img class="nerd-image" alt="Nerd Profile Picture" src="photos/chadi.png">
                        </div>
                        <div class="nerd-info-section">
                            <h2 class="nerd-name">Chadi Brush</h2>
                            <div class="nerd-tags-container">
                                <span class="category-tag">Education</span>
                                <span class="category-tag">Business</span>
                            </div>
                        </div>
                        <div class="nerd-actions-section">
                            <button class="btn btn-primary action-button chat-btn">Chat with Me</button>
                            <button class="btn btn-outline-primary action-button about-btn">About Me</button>
                        </div>
                        <div class="favorite-toggle">
                            <i class="bi bi-heart favorite-icon"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- About Me Modal (Hidden by default) -->
    <div class="modal-overlay hidden" id="aboutModal">
        <div class="modal about-modal">
            <div class="modal-header">
                <h3 class="modal-title">About Nerd</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <div class="about-nerd-profile">
                    <div class="about-nerd-header">
                        <div class="about-nerd-avatar" id="modal-avatar" style="background-image: url('photos/andrew.png');"></div>
                        <div>
                            <h3 class="about-nerd-name" id="modal-name">Andrew DeBad</h3>
                            <div class="about-nerd-categories" id="modal-categories">
                                <span class="category-tag">Business</span>
                                <span class="category-tag">Executive</span>
                            </div>
                        </div>
                    </div>
                    
                    <p class="about-nerd-bio" id="modal-bio">
                        Andrew DeBad serves as Inglet Blair, a QC Ally Company's Vice President of Business Development. 
                        In this role, he fosters lasting relationships through a commitment to true partnership with both 
                        new and existing clients.
                        <br><br>
                        Seasoned in the realms of finance and technology, Andrew brings over 20 years of diverse experience 
                        as a founder and C-suite executive. He has successfully navigated businesses from startups to Fortune 
                        500 companies, specializing in operations, product and business development, as well as client service 
                        management.
                        <br><br>
                        Andrew's approach is rooted in strategic growth, innovation, and fostering mentally healthy workplace 
                        cultures. Passionate about mental health advocacy and a compelling communicator, he is dedicated to 
                        guiding companies towards sustainable success and cultivating next-level teams.
                    </p>
                    
                    <div class="about-company" id="modal-company">
                        <h4>About Ask A Bob</h4>
                        <p>Get Instant Answers for your Enterprise Teams. It's like having a trusted ally in your corner, 
                        ready to tackle all of your business needs. Your own private, secure LLM trained with your company's 
                        data, helping your teams learn and move at lightspeed.</p>
                    </div>
                    
                    <div class="about-nerd-reviews">
                        <h4>Reviews</h4>
                        <div class="review-item">
                            <div class="review-header">
                                <span class="review-author">Sarah T.</span>
                                <div class="review-stars">â˜…â˜…â˜…â˜…â˜…</div>
                            </div>
                            <p class="review-text">Andrew provided invaluable insights for our business strategy. His experience is evident in every conversation.</p>
                        </div>
                        <div class="review-item">
                            <div class="review-header">
                                <span class="review-author">Michael L.</span>
                                <div class="review-stars">â˜…â˜…â˜…â˜…â˜…</div>
                            </div>
                            <p class="review-text">A true business development expert. Andrew helped us navigate complex partnership negotiations with ease.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-chat-modal">Chat with Me</button>
            </div>
        </div>
    </div>

    <!-- Chat Modal (Hidden by default) -->
    <div class="modal-overlay hidden" id="chatModal">
        <div class="modal chat-modal">
            <div class="chat-modal-inner">
            <div class="modal-header">
                <h3 class="modal-title">Chat with <span class="chat-nerd-name">Andrew DeBad</span></h3>
                <button class="modal-close">&times;</button>
            </div>
                <div class="modal-content chat-messages" id="chatMessages">
                    <!-- Messages will be added here -->
                </div>
                <div class="chat-footer">
                    <div class="chat-input-wrapper">
                        <textarea class="chat-input" placeholder="Type your message..." id="chatInput" spellcheck="false"></textarea>
                        <button class="chat-send-btn" id="sendMessage" disabled>Send Message</button>
            </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Panel Styling -->
    <style>
        /* Nerd Card Styling */
        .nerd-card {
            position: relative;
            width: 100%; /* Make width responsive */
            max-width: 240px; /* Set a max width */
            height: auto; /* Allow height to adjust */
            min-height: 300px; /* Minimum height to maintain structure */
            padding: 0;
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            margin: 0.7rem; /* Smaller margin */
            overflow: hidden;
            background: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        /* Inner container with fixed sections */
        .nerd-card-inner {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Ensure nothing leaks out */
        }

        /* Top section for image - flexible height */
        .nerd-image-section {
            width: 100%;
            padding: 40px 0; /* Increased padding from 20px to 30px */
            display: flex;
            justify-content: center;
            align-items: center; /* Center align image */
            overflow: hidden; /* Prevent overflow */
            position: relative; /* For positioning context */
            background-color: #f8f9fa; /* Light background */
            border-bottom: 1px solid rgba(0, 0, 0, 0.05); /* Subtle separator */
        }

        /* Nerd Image Styling */
        .nerd-image {
            width: 80px !important; /* Larger image */
            height: 80px !important; /* Larger image */
            max-width: 80px !important; 
            max-height: 80px !important;
            min-width: 80px !important;
            min-height: 80px !important;
            border-radius: 8px !important; /* Changed from 50% to 8px for square with slightly rounded corners */
            background-color: white;
            border: 2px solid #0d6efd;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            z-index: 2; /* Ensure image is above background elements */
            box-sizing: border-box; /* Include border in size calculation */
            flex-shrink: 0; /* Prevent shrinking */
            object-fit: cover; /* Ensure image maintains aspect ratio */
            position: relative; /* Positioning context */
            margin-top: 10px; /* Added margin to move the image down more */
        }

        /* Middle section for info - flexible height */
        .nerd-info-section {
            width: 100%;
            padding: 15px 10px 0; /* Increased top padding */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align content to start to prevent overlap */
        }

        .nerd-name {
            margin: 0 0 12px 0; /* Increased bottom margin for more space */
            padding: 0;
            width: 100%;
            font-size: 20px; /* Slightly larger font */
            color: #333;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nerd-categories {
            display: flex;
            flex-wrap: nowrap;
            justify-content: center;
            width: 100%;
            overflow: hidden;
        }

        .category-tag {
            margin: 0 3px; /* Less margin */
            padding: 3px 8px; /* Less padding */
            font-size: 12px; /* Smaller font */
            color: #0d6efd;
            background-color: rgba(13, 110, 253, 0.1);
            border-radius: 20px;
            white-space: nowrap;
        }

        .btn {
            height: 40px; /* Shorter buttons */
            width: 100%;
            border-radius: 20px;
            font-size: 15px; /* Smaller font */
            font-weight: 500;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #0d6efd;
            color: white;
            border: none;
        }

        .btn-outline {
            background-color: white;
            color: #555;
            border: 1px solid #ddd;
        }

        /* Favorite button */
        .favorite-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            color: #0d6efd;
            cursor: pointer;
            z-index: 10;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Make the grid layout more compact and responsive */
        .nerds-grid {
            display: flex; /* Switch to flexbox for single column */
            flex-direction: column; /* Stack items vertically */
            align-items: center; /* Center items horizontally */
            gap: 15px; /* Smaller gap */
            padding: 15px;
        }

        /* About Nerd Avatar Styling */
        .about-nerd-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .about-nerd-avatar {
            width: 100px;
            height: 100px;
            border-radius: 6px; /* Match the square style */
            background-color: white;
            border: 1px solid #0d6efd;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            box-shadow: none;
        }

        /* Modal styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background for overlay */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            overflow-y: auto;
            backdrop-filter: none; /* Remove any blur effect */
        }

        .modal {
            background: white; /* Solid background for modal */
            max-width: 600px; /* Fixed max width */
            width: 90%; /* Responsive width */
            height: auto; /* Auto height */
            max-height: 90vh; /* Limit height */
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); /* Shadow for depth */
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            margin: 1rem; /* Margin for spacing */
        }

        .about-modal {
            max-width: 600px; /* Ensure same max width */
            height: auto; /* Auto height to fit content */
            max-height: 90vh; /* Ensure it doesn't exceed viewport height */
            background: white; /* Solid white background */
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); /* Add shadow for window effect */
        }

        .modal-header {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc; /* Light background for header */
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            height: 32px;
            width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .modal-close:hover {
            background-color: #e2e8f0;
        }

        .modal-content {
            padding: 1.5rem;
            overflow-y: auto; /* Allow scrolling */
            flex: 1; /* Allow it to grow and take available space */
        }

        .modal-content.chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            padding-bottom: 152px;
        }

        .chat-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px;
            border-top: 1px solid #e2e8f0;
            box-shadow: none;
            height: 140px;
            box-sizing: border-box;
        }

        .chat-input-wrapper {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            position: relative;
            padding: 10px;
            box-sizing: border-box;
        }

        .chat-input {
            width: 100%;
            height: 45px;
            min-height: 45px;
            max-height: 45px;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            resize: none;
            font-family: inherit;
            font-size: 1rem;
            background: white;
            box-sizing: border-box;
            display: block;
            z-index: 10;
            position: relative;
        }

        .chat-send-btn {
            width: 90%;
            height: 45px;
            min-height: 45px;
            max-height: 45px;
            background: #0d6efd;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: none;
            display: block;
            margin: 10px auto 0; /* Reduced top margin */
            z-index: 10;
            position: relative;
        }

        .chat-send-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .chat-send-btn:hover:not(:disabled) {
            background: #0b5ed7;
        }

        .chat-messages {
            display: flex;
            flex-direction: column; /* Stack messages vertically */
            padding: 1.25rem; /* Padding for the messages */
            overflow-y: auto; /* Allow scrolling */
        }

        /* Chat Message Styling */
        .chat-message {
            margin-bottom: 1rem;
            max-width: 80%;
            border-radius: 20px;
            padding: 10px 15px;
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            background-color: #f1f5f9; /* Default background */
        }

        /* User message bubble */
        .user-message {
            align-self: flex-end;
            background: #d1e7fd; /* Light blue background for user messages */
            color: #1e293b; /* Text color for user messages */
            margin-left: auto; /* Push to right */
            border-bottom-right-radius: 5px; /* Add a tail effect */
        }

        /* Nerd message bubble */
        .nerd-message {
            align-self: flex-start;
            background: #f1f5f9; /* Light gray background */
            color: #1e293b; /* Text color */
            margin-right: auto; /* Push to left */
            border-bottom-left-radius: 5px; /* Add a tail effect */
        }

        .typing-indicator {
            opacity: 0.7;
            background-color: #f1f5f9;
            position: relative;
            z-index: 5; /* Make sure it's above other content but below footer */
        }

        /* Mobile-specific message styling */
        @media (max-width: 768px) {
            .chat-message {
                max-width: 85%; /* Wider messages on mobile */
                clear: both; /* Prevent wrapping issues */
                position: relative;
                z-index: 5;
                margin-bottom: 0.8rem;
            }
            
            .nerd-message {
                float: left;
                background-color: #f1f5f9; /* Ensure consistent background */
            }
            
            .user-message {
                float: right;
                background-color: #d1e7fd; /* Ensure consistent background */
            }
            
            .message-content {
                position: relative;
                z-index: 6;
                background: transparent;
            }
            
            .chat-messages::after {
                content: "";
                display: table;
                clear: both;
            }
        }

        /* Error message styling (more prominent) */
        .error-message {
            background: #fee2e2 !important;
            color: #dc2626 !important;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
            border: 1px solid #fecaca;
            word-break: break-word;
            clear: both;
            max-width: 90% !important;
            margin-left: auto;
            margin-right: auto;
            float: none !important;
        }

        /* Add hidden class */
        .hidden {
            display: none !important;
        }

        /* Chat input area styling */
        .chat-input-area {
            position: relative; /* Change to relative positioning */
            padding: 1rem; /* Padding for the input area */
            background-color: #f8fafc; /* Background color */
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); /* Shadow for separation */
            z-index: 10; /* Ensure it stays above other content */
        }

        /* Button Styling */
        .btn {
            width: 100%; /* Full width */
            padding: 0.75rem; /* Consistent padding */
            border-radius: 12px; /* Rounded corners */
            font-size: 1rem; /* Font size */
            font-weight: 500; /* Font weight */
            transition: all 0.2s ease; /* Transition for hover effects */
        }

        /* Specific styles for Chat and About buttons */
        .btn-primary {
            background: linear-gradient(135deg, #0d6efd, #0a58ca); /* Chat button background */
            color: white; /* Text color */
        }

        .btn-outline {
            border: 1px solid #cbd5e1; /* Outline button border */
            color: #475569; /* Text color */
        }

        .btn-outline:hover {
            background-color: #f1f5f9; /* Hover effect */
            color: #334155; /* Text color on hover */
        }

        /* About Me Modal */
        .about-modal {
            max-width: 600px; /* Ensure same max width */
            height: auto; /* Auto height to fit content */
            max-height: 90vh; /* Ensure it doesn't exceed viewport height */
            background: white; /* Solid white background */
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); /* Add shadow for window effect */
        }

        .modal-header {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            background: white;
            z-index: 10;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            height: 32px;
            width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background-color: #f1f5f9;
        }

        .modal-content {
            padding: 1rem;
            overflow-y: auto; /* Allow scrolling */
            flex: 1; /* Allow it to grow and take available space */
        }

        .modal-footer {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            background: white;
            display: flex;
            justify-content: center;
        }

        .btn-chat-modal {
            background: linear-gradient(135deg, #0d6efd, #0a58ca);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-chat-modal:hover {
            background: linear-gradient(135deg, #0a58ca, #084298);
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            .modal {
                width: 100%;
                height: 100%;
                max-width: 100%;
                max-height: 100%;
                border-radius: 0;
                margin: 0;
            }

            .chat-modal {
                height: 100vh;
                border-radius: 0;
                overflow: hidden; /* Prevent body scrolling */
            }

            .modal-content.chat-messages {
                height: calc(100vh - 152px);
                padding-bottom: 152px;
            }

            .chat-footer {
                padding: 12px;
                height: 140px;
            }

            .chat-input {
                width: 100%;
            }

            .chat-send-btn {
                width: 90%;
                margin-left: auto;
                margin-right: auto;
                font-size: 0.95rem;
            }
            
            /* Restore mobile-specific styles */
            .container {
                padding: 1rem;
            }

            .nerds-grid {
                gap: 10px; /* Smaller gap */
                padding: 10px;
            }
            
            .nerd-card {
                max-width: 100%; /* Full width within grid cell */
                min-height: 250px; /* Smaller minimum height */
            }
            
            .nerd-image-section {
                padding: 15px 0; /* Slightly less padding on mobile */
            }
            
            .nerd-image {
                width: 70px !important; /* Still larger than before, but slightly smaller for mobile */
                height: 70px !important;
                max-width: 70px !important;
                max-height: 70px !important;
                min-width: 70px !important;
                min-height: 70px !important;
            }
            
            .nerd-info-section {
                min-height: 80px; /* Further reduced height for mobile */
                padding-top: 5px;
            }
            
            .nerd-actions-section {
                min-height: 80px; /* Smaller minimum height */
            }

            .category-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding: 0.5rem 0;
                margin: 0 -1rem;
                scroll-padding: 1rem;
            }

            .category-tabs::-webkit-scrollbar {
                display: none;
            }

            .category-tab {
                flex: 0 0 auto;
                font-size: 0.9rem;
                padding: 0.5rem 1rem;
                white-space: nowrap;
                transition: none; /* Remove any transition effects */
                cursor: pointer; /* Keep the pointer cursor */
            }

            /* Remove hover effect */
            .category-tab:hover {
                transform: none; /* Ensure no movement on hover */
                background-color: transparent; /* Ensure background does not change */
            }

            .controls-row {
                flex-direction: column;
                gap: 1rem;
            }

            .modal-content.chat-messages {
                padding-bottom: 152px; /* Adjust padding for mobile */
            }
        }

        /* Chat Modal Styling */
        .chat-modal {
            display: flex;
            flex-direction: column;
            height: 80vh;
            max-width: 600px;
            width: 100%;
            position: relative;
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        .chat-modal-inner {
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            overflow: hidden; /* Prevent double scrolling */
        }

        .chat-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px;
            border-top: 1px solid #e2e8f0;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1); /* Add shadow for separation */
            height: 140px;
            box-sizing: border-box;
            z-index: 10; /* Ensure it stays above content */
        }

        .modal-content.chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            padding-bottom: 152px; /* Ensure space for footer */
            height: calc(100% - 60px); /* Adjust for header height */
            position: relative;
            background: white;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .chat-modal {
                height: 100vh;
                max-height: 100vh;
                width: 100%;
                max-width: 100%;
                border-radius: 0;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
            }

            .chat-footer {
                width: 100%;
                height: 140px;
                position: fixed; /* Use fixed instead of absolute */
                bottom: 0;
                left: 0;
                z-index: 20; /* Higher z-index */
            }

            .modal-content.chat-messages {
                padding-bottom: 160px; /* Extra padding to ensure messages don't get hidden */
                margin-bottom: 0;
                height: calc(100% - 60px); /* Adjust for header */
            }
            
            .chat-message {
                position: relative; /* Ensure proper stacking */
                z-index: 1; /* Lower than the footer */
            }
            
            .modal-header {
                position: sticky;
                top: 0;
                z-index: 20;
                background: white;
            }
        }

        /* Improved message content formatting */
        .message-content {
            white-space: pre-wrap;
            word-break: break-word;
            line-height: 1.5;
        }
        
        /* Adding proper spacing for list items in chat */
        .message-content ol, 
        .message-content ul {
            padding-left: 1.5rem;
            margin: 0.5rem 0;
        }
        
        .message-content li {
            margin-bottom: 0.5rem;
        }
        
        .message-content p {
            margin-bottom: 0.8rem;
        }

        /* Additional fixes for mobile chat */
        @media (max-width: 768px) {
            .chat-input-wrapper {
                position: relative;
                z-index: 30;
                background: white;
                border-top: 1px solid #e2e8f0;
                padding: 10px;
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }
            
            .chat-input {
                width: 100%;
                border: 1px solid #cbd5e1;
                background: white;
                font-size: 16px;
                margin-bottom: 8px; /* Add margin below input */
            }
            
            .chat-send-btn {
                width: 100%;
                margin-top: 5px; /* Reduce space between input and button */
                height: 45px;
                min-height: 45px;
                max-height: 45px;
                margin-bottom: 5px;
            }
            
            .chat-footer {
                padding: 0;
                background: white;
                box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
                height: 120px; /* Reduced height */
            }
            
            /* Update padding to account for smaller footer */
            #chatMessages {
                padding-bottom: 140px !important;
            }
            
            /* Improve button tap target */
            .chat-send-btn {
                -webkit-tap-highlight-color: rgba(0,0,0,0);
                touch-action: manipulation;
            }
            
            /* Ensure proper message display on mobile */
            #chatMessages {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                position: relative;
                z-index: 5;
                background-color: white;
            }
            
            /* Fix modal content scroll */
            .modal-content {
                -webkit-overflow-scrolling: touch;
            }
            
            /* Prevent input zoom on iOS */
            input, textarea, select {
                font-size: 16px !important;
            }
            
            /* Modal styling fixes */
            .modal-overlay {
                position: fixed;
                width: 100vw;
                height: 100vh;
                overflow: hidden;
            }
            
            /* Fix for chat modal */
            .chat-modal-inner {
                overflow: hidden !important;
                height: 100% !important;
                display: flex;
                flex-direction: column;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // Preload images
        const imagesToPreload = [
            'photos/andrew.png',
            'photos/lisa.png',
            'photos/karl.png',
            'photos/chadi.png'
        ];
        
        imagesToPreload.forEach(src => {
            const img = new Image();
            img.src = src;
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            // Data for each nerd
            const nerdProfiles = {
                'Andrew DeBad': {
                    categories: ['Business', 'Executive'],
                    bio: `Andrew DeBad serves as Inglet Blair, a QC Ally Company's Vice President of Business Development. 
                          In this role, he fosters lasting relationships through a commitment to true partnership with both 
                          new and existing clients.
                          <br><br>
                          Seasoned in the realms of finance and technology, Andrew brings over 20 years of diverse experience 
                          as a founder and C-suite executive. He has successfully navigated businesses from startups to Fortune 
                          500 companies, specializing in operations, product and business development, as well as client service 
                          management.
                          <br><br>
                          Andrew's approach is rooted in strategic growth, innovation, and fostering mentally healthy workplace 
                          cultures. Passionate about mental health advocacy and a compelling communicator, he is dedicated to 
                          guiding companies towards sustainable success and cultivating next-level teams.`,
                    company: {
                        name: 'Ask A Bob',
                        description: `Get Instant Answers for your Enterprise Teams. It's like having a trusted ally in your corner, 
                                     ready to tackle all of your business needs. Your own private, secure LLM trained with your company's 
                                     data, helping your teams learn and move at lightspeed.`
                    },
                    avatar: 'photos/andrew.png',
                    reviews: [
                        {
                            author: 'Sarah T.',
                            stars: 5,
                            text: 'Andrew provided invaluable insights for our business strategy. His experience is evident in every conversation.'
                        },
                        {
                            author: 'Michael L.',
                            stars: 5,
                            text: 'A true business development expert. Andrew helped us navigate complex partnership negotiations with ease.'
                        }
                    ]
                },
                'Lisa Menu': {
                    categories: ['Marketing', 'Academic'],
                    bio: `Lisa Menu is a Clinical Assistant Professor of Marketing in the Department of Management and Marketing. 
                          Upon graduating from the Doctorate of Business Administration Program, Hough Graduate School of Business, 
                          University of Florida, she took a visiting assistant marketing professor position at Purdue University Fort Wayne.
                          <br><br>
                          Her academic journey began because of her desire to share her experiences with others who were starting 
                          their careers. She has held senior positions at large regional banks in the Midwest and Mid-Atlantic. 
                          In 2013, Lisa and her husband decided to move back to Michigan.
                          <br><br>
                          She took this unique opportunity to utilize her industry experience and academic background to enter academia. 
                          Obtaining her doctorate and teaching at the college level has been a dream career for her for many years.
                          <br><br>
                          She also completed the 2018 Chicago Marathon.`,
                    company: {
                        name: 'Purdue University',
                        description: `As a marketing manager and product innovator, Lisa's primary role was creating marketing strategies 
                                     and introducing new products and services to consumers. Her success can be attributed to knowing the 
                                     customer, understanding the business, and looking for opportunities to develop competitive advantages.`
                    },
                    avatar: 'photos/lisa.png',
                    reviews: [
                        {
                            author: 'David R.',
                            stars: 5,
                            text: 'Lisa\'s marketing expertise transformed our approach to customer engagement. Her academic insights combined with practical experience are invaluable.'
                        },
                        {
                            author: 'Jennifer K.',
                            stars: 5,
                            text: 'Outstanding mentor in marketing strategy. Lisa helped us develop a comprehensive digital marketing plan that exceeded our expectations.'
                        }
                    ]
                },
                'Karl Fruit': {
                    categories: ['Entrepreneurship', ],
                    bio: `Karl mentors and guides student teams, and actively recruits other business professionals to lend their 
                          own time and expertise to programs. As a successful intrapreneur, Karl has the knowledge and experience to 
                          help others identify market opportunities and growth targets with strategy, technology and know-how.
                          <br><br>
                          Showing that inspiration can come at any time, Karl and Michael Miles proved that a few years back as they 
                          were reflecting on education at a graduation party and were inspired to start Uncharted Learning. Their goal 
                          was to shape the future of high school business education with an approach that engaged and empowered students 
                          in new ways.
                          <br><br>
                          Looking Back: "I've been able to have an impact on some cool businesses and amazing projects, along side some good people."
                          <br>
                          Looking forward: "Let's get students to create their own similar experiences."`,
                    company: {
                        name: 'Uncharted Learning',
                        description: `"There are only two types of people in the world: People afraid to try, and people not afraid to be wrong."
                                     Karl's wisdom and approach to entrepreneurship has shaped the educational experience of many students.`
                    },
                    avatar: 'photos/karl.png',
                    reviews: [
                        {
                            author: 'Alex M.',
                            stars: 5,
                            text: 'Karl\'s mentorship was instrumental in launching our startup. His entrepreneurial insights and practical guidance are gold.'
                        },
                        {
                            author: 'Rachel S.',
                            stars: 5,
                            text: 'Exceptional advisor for young entrepreneurs. Karl\'s approach to problem-solving and business development is both innovative and practical.'
                        }
                    ]
                },
                'Chadi Brush': {
                    categories: ['Education', 'Business'],
                    bio: `Chadi Brush serves as the Executive Director of Continuing Studies, bringing valuable expertise in 
                          educational administration and business practices to the role. With a Master of Business Administration 
                          degree, Chadi combines strong academic credentials with practical business experience.
                          <br><br>
                          He is responsible for developing and implementing continuing education programs, working closely with 
                          faculty and industry partners to ensure course offerings meet the needs of adult learners and professionals 
                          seeking to advance their careers.
                          <br><br>
                          Chadi's leadership focuses on creating accessible, high-quality educational opportunities that bridge 
                          the gap between academic knowledge and workforce demands in the modern economy.`,
                    company: {
                        name: 'Continuing Studies Department',
                        description: `The Continuing Studies Department offers professional development courses, certificate programs, 
                                     and non-degree learning opportunities for adult learners looking to enhance their skills or 
                                     transition to new career paths.`
                    },
                    avatar: 'photos/chadi.png',
                    reviews: [
                        {
                            author: 'Patricia N.',
                            stars: 5,
                            text: 'Chadi\'s expertise in educational program development is outstanding. He helped us create a cutting-edge professional development curriculum.'
                        },
                        {
                            author: 'Robert W.',
                            stars: 5,
                            text: 'Brilliant educator and administrator. Chadi\'s insights into continuing education and professional development are transformative.'
                        }
                    ]
                }
            };

            // Load profile images for cards
            const profilePics = document.querySelectorAll('.nerd-image');
            
            profilePics.forEach(pic => {
                const card = pic.closest('.nerd-card');
                const nerdName = card.querySelector('.nerd-name').textContent;
                const nerdData = nerdProfiles[nerdName];
                
                if (nerdData) {
                    pic.style.backgroundImage = `url('${nerdData.avatar}')`;
                    pic.style.display = 'block';
                }
            });
            
            // Category tabs functionality
            const categoryTabs = document.querySelectorAll('.category-tab');
            const nerdCards = document.querySelectorAll('.nerd-card');
            
            categoryTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    categoryTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    const selectedCategory = this.getAttribute('data-category');
                    
                    // Filter nerd cards
                    nerdCards.forEach(card => {
                        const categories = card.getAttribute('data-categories').split(',');
                        
                        if (selectedCategory === 'all') {
                            card.style.display = 'flex';
                        } else if (categories.includes(selectedCategory)) {
                            card.style.display = 'flex';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });

            // Search functionality
            const searchInput = document.querySelector('.search-input');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                
                nerdCards.forEach(card => {
                    const name = card.querySelector('.nerd-name').textContent.toLowerCase();
                    const categories = card.getAttribute('data-categories').toLowerCase();
                    const bio = card.querySelector('.nerd-mini-bio').textContent.toLowerCase();
                    
                    if (
                        name.includes(searchTerm) || 
                        categories.includes(searchTerm) || 
                        bio.includes(searchTerm)
                    ) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });

            // Favorite button functionality
            const favoriteButtons = document.querySelectorAll('.favorite-btn');
            favoriteButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent triggering card click
                    this.classList.toggle('active');
                    const path = this.querySelector('path');
                    if (this.classList.contains('active')) {
                        path.setAttribute('fill', 'currentColor');
                    } else {
                        path.setAttribute('fill', 'none');
                    }
                });
            });
            
            // Favorites toggle functionality
            const favoritesToggle = document.querySelector('.favorites-toggle');
            let showingFavorites = false;
            
            favoritesToggle.addEventListener('click', function() {
                showingFavorites = !showingFavorites;
                
                if (showingFavorites) {
                    this.classList.add('active');
                    nerdCards.forEach(card => {
                        const isFavorite = card.querySelector('.favorite-btn').classList.contains('active');
                        card.style.display = isFavorite ? 'flex' : 'none';
                    });
                } else {
                    this.classList.remove('active');
                    // Show all cards or respect the current category filter
                    const activeCategory = document.querySelector('.category-tab.active').getAttribute('data-category');
                    nerdCards.forEach(card => {
                        const categories = card.getAttribute('data-categories').split(',');
                        if (activeCategory === 'all') {
                            card.style.display = 'flex';
                        } else if (categories.includes(activeCategory)) {
                            card.style.display = 'flex';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                }
            });

            // Function to update review items
            function updateReviewItems(reviews) {
                const reviewsContainer = document.querySelector('.about-nerd-reviews');
                reviewsContainer.innerHTML = '<h4>Reviews</h4>';
                
                reviews.forEach(review => {
                    const reviewItem = document.createElement('div');
                    reviewItem.className = 'review-item';
                    
                    const stars = 'â˜…'.repeat(review.stars) + 'â˜†'.repeat(5 - review.stars);
                    
                    reviewItem.innerHTML = `
                        <div class="review-header">
                            <span class="review-author">${review.author}</span>
                            <div class="review-stars">${stars}</div>
                        </div>
                        <p class="review-text">${review.text}</p>
                    `;
                    
                    reviewsContainer.appendChild(reviewItem);
                });
            }
            
            // Update About Me modal functionality
            const aboutButtons = document.querySelectorAll('.about-btn');
            const aboutModal = document.getElementById('aboutModal');
            
            aboutButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Get the nerd name from the card
                    const card = this.closest('.nerd-card');
                    const nerdName = card.querySelector('.nerd-name').textContent;
                    const nerdData = nerdProfiles[nerdName];
                    
                    if (nerdData) {
                        // Update modal content
                        document.getElementById('modal-name').textContent = nerdName;
                        document.getElementById('modal-bio').innerHTML = nerdData.bio;
                        
                        // Update avatar image
                        document.getElementById('modal-avatar').style.backgroundImage = `url('${nerdData.avatar}')`;
                        
                        // Update categories
                        const categoriesContainer = document.getElementById('modal-categories');
                        categoriesContainer.innerHTML = '';
                        nerdData.categories.forEach(category => {
                            const span = document.createElement('span');
                            span.className = 'category-tag';
                            span.textContent = category;
                            categoriesContainer.appendChild(span);
                        });
                        
                        // Update company info
                        const companySection = document.getElementById('modal-company');
                        companySection.innerHTML = `
                            <h4>About ${nerdData.company.name}</h4>
                            <p>${nerdData.company.description}</p>
                        `;
                        
                        // Update reviews
                        updateReviewItems(nerdData.reviews);
                    }
                    
                    // Show the About Me modal
                    aboutModal.classList.remove('hidden');
                });
            });

            // Store chat history for each nerd
            const chatHistory = {};
            
            // Chat button functionality
            const chatButtons = document.querySelectorAll('.chat-btn');
            const chatModal = document.getElementById('chatModal');
            
            chatButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.nerd-card');
                    const nerdName = card.querySelector('.nerd-name').textContent;
                    
                    // Update chat modal with nerd's name
                    document.querySelector('.chat-nerd-name').textContent = nerdName;
                    
                    // Clear previous chat and load history if exists
                    const chatMessages = document.getElementById('chatMessages');
                    chatMessages.innerHTML = '';
                    
                    // Check if there's history for this nerd
                    if (chatHistory[nerdName] && chatHistory[nerdName].length > 0) {
                        // Restore previous messages
                        chatHistory[nerdName].forEach(msg => {
                            chatMessages.appendChild(msg.cloneNode(true));
                        });
                    } else {
                        // Send introductory message for first-time chats
                        const introMessage = `Hello! I'm ${nerdName}. How can I assist you today?`;
                        const messageElement = document.createElement('div');
                        messageElement.className = 'chat-message nerd-message';
                        messageElement.innerHTML = `<div class="message-content">${introMessage}</div>`;
                        chatMessages.appendChild(messageElement);
                        
                        // Initialize chat history for this nerd
                        chatHistory[nerdName] = [messageElement.cloneNode(true)];
                    }
                    
                    // Show the Chat modal
                    chatModal.classList.remove('hidden');
                    
                    // Auto-scroll to the bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                });
            });

            // Close modal functionality
            const modalCloseButtons = document.querySelectorAll('.modal-close');
            modalCloseButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal-overlay');
                    modal.classList.add('hidden');
                });
            });

            const chatInput = document.getElementById('chatInput');
            const sendMessageButton = document.getElementById('sendMessage');

            chatInput.addEventListener('input', function() {
                sendMessageButton.disabled = this.value.trim() === '';
            });

            // Add functionality to send messages
            const sendMessage = function() {
                const message = chatInput.value.trim();
                if (message) {
                    // Get current nerd name
                    const nerdName = document.querySelector('.chat-nerd-name').textContent;
                    
                    // Add the message to the chat messages area
                    const messageElement = document.createElement('div');
                    messageElement.className = 'chat-message user-message';
                    messageElement.innerHTML = `<div class="message-content">${message}</div>`;
                    document.getElementById('chatMessages').appendChild(messageElement);
                    
                    // Add to chat history
                    if (!chatHistory[nerdName]) {
                        chatHistory[nerdName] = [];
                    }
                    chatHistory[nerdName].push(messageElement.cloneNode(true));
                    
                    // Clear the input
                    chatInput.value = '';
                    sendMessageButton.disabled = true; // Disable the button again
                    
                    // Auto-scroll to the bottom
                    const chatMessages = document.getElementById('chatMessages');
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Show typing indicator
                    const typingIndicator = document.createElement('div');
                    typingIndicator.className = 'chat-message nerd-message typing-indicator';
                    typingIndicator.innerHTML = `<div class="message-content">Typing...</div>`;
                    chatMessages.appendChild(typingIndicator);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Call the API instead of simulating a response
                    fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: message,
                            nerdName: nerdName,
                            nerdExpertise: getNerdExpertise(nerdName)
                        })
                    })
                    .then(response => {
                        console.log('API Response Status:', response.status);
                        if (!response.ok) {
                            return response.json().then(errorData => {
                                throw new Error(errorData.error || 'API request failed');
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('API Response Data:', data);
                        // Remove typing indicator
                        document.querySelector('.typing-indicator')?.remove();
                        
                        // Create response message
                        const responseElement = document.createElement('div');
                        responseElement.className = 'chat-message nerd-message';
                        
                        // Check if we have a valid response
                        if (data && data.response) {
                            // Use the marked library to parse markdown
                            try {
                                const formattedResponse = marked.parse(data.response);
                                responseElement.innerHTML = `<div class="message-content">${formattedResponse}</div>`;
                            } catch (e) {
                                // Fallback if markdown parsing fails
                                console.error('Markdown parsing error:', e);
                                const safeResponse = data.response
                                    .replace(/\n/g, '<br>')
                                    .replace(/</g, '&lt;')
                                    .replace(/>/g, '&gt;');
                                responseElement.innerHTML = `<div class="message-content">${safeResponse}</div>`;
                            }
                        } else {
                            responseElement.innerHTML = `<div class="message-content">I'm sorry, I couldn't generate a response at this time.</div>`;
                        }
                        
                        chatMessages.appendChild(responseElement);
                        
                        // Add to chat history
                        chatHistory[nerdName].push(responseElement.cloneNode(true));
                        
                        // Auto-scroll to the bottom
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    })
                    .catch(error => {
                        console.error('Error details:', error);
                        
                        // Remove typing indicator
                        const typingIndicator = document.querySelector('.typing-indicator');
                        if (typingIndicator) {
                            typingIndicator.remove();
                        }
                        
                        // Show error message
                        const errorElement = document.createElement('div');
                        errorElement.className = 'chat-message error-message';
                        errorElement.innerHTML = `<div class="message-content">Sorry, I couldn't process your request: ${error.message || 'Unknown error'}</div>`;
                        chatMessages.appendChild(errorElement);
                        
                        // Add to chat history
                        chatHistory[nerdName].push(errorElement.cloneNode(true));
                        
                        // Auto-scroll to the bottom
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    });
                }
            };

            // Add click handler for the send button
            sendMessageButton.addEventListener('click', sendMessage);
            
            // Allow sending message with Enter key
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (!sendMessageButton.disabled) {
                        sendMessage();
                    }
                }
            });
            
            // Helper function to get nerd expertise based on name
            function getNerdExpertise(nerdName) {
                const nerdData = nerdProfiles[nerdName];
                if (nerdData && nerdData.categories) {
                    return nerdData.categories.join(', ');
                }
                return 'various topics';
            }
            
            // Also add chat functionality to the "Chat with Me" button in the about modal
            document.querySelector('.btn-chat-modal').addEventListener('click', function() {
                // Get the nerd name from the about modal
                const nerdName = document.getElementById('modal-name').textContent;
                
                // Update chat modal with nerd's name
                document.querySelector('.chat-nerd-name').textContent = nerdName;
                
                // Hide about modal and show chat modal
                document.getElementById('aboutModal').classList.add('hidden');
                chatModal.classList.remove('hidden');
                
                // Clear previous chat and load history if exists
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.innerHTML = '';
                
                // Check if there's history for this nerd
                if (chatHistory[nerdName] && chatHistory[nerdName].length > 0) {
                    // Restore previous messages
                    chatHistory[nerdName].forEach(msg => {
                        chatMessages.appendChild(msg.cloneNode(true));
                    });
                } else {
                    // Send introductory message for first-time chats
                    const introMessage = `Hello! I'm ${nerdName}. How can I assist you today?`;
                    const messageElement = document.createElement('div');
                    messageElement.className = 'chat-message nerd-message';
                    messageElement.innerHTML = `<div class="message-content">${introMessage}</div>`;
                    chatMessages.appendChild(messageElement);
                    
                    // Initialize chat history for this nerd
                    chatHistory[nerdName] = [messageElement.cloneNode(true)];
                }
                
                // Auto-scroll to the bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });

            // Add typing indicator styles
            const styleElement = document.createElement('style');
            styleElement.innerHTML = `
                .typing-indicator {
                    opacity: 0.7;
                }
                
                /* Error message styling (more prominent) */
                .error-message {
                    background: #fee2e2 !important;
                    color: #dc2626 !important;
                    padding: 1rem;
                    margin: 0.5rem 0;
                    border-radius: 8px;
                    font-size: 0.9rem;
                    text-align: center;
                    border: 1px solid #fecaca;
                    word-break: break-word;
                    clear: both;
                    max-width: 90% !important;
                    margin-left: auto;
                    margin-right: auto;
                    float: none !important;
                }
                
                /* Improved message content formatting */
                .message-content {
                    white-space: pre-wrap;
                    word-break: break-word;
                    line-height: 1.5;
                }
                
                /* Adding proper spacing for list items in chat */
                .message-content ol, 
                .message-content ul {
                    padding-left: 1.5rem;
                    margin: 0.5rem 0;
                }
                
                .message-content li {
                    margin-bottom: 0.5rem;
                }
                
                .message-content p {
                    margin-bottom: 0.8rem;
                }
            `;
            document.head.appendChild(styleElement);
        });
    </script>
</body>
</html>